# Сценарии использования

## Списание бонусов {id="bonuses_writeOff"}
<procedure>
<step>
Создать заказ
</step>
<step>
Добавить гостя в заказ
</step>
<step>
Перейти на экран оплаты
</step>
<step>
Добавить тип оплаты бонусами
</step>
<step>
<p>Нажать "Да"</p>
<img src="guest_info_payment_screen.png" alt="" border-effect="rounded"/>
</step>
<step>
Оплатить заказ
</step>
</procedure>
>
> Не обязательно списывать все доступые бонусы. После добавления платежа сумму списания всегда можно изменить.
Однако максимальное количество бонусов фиксировано и больше этого числа списать нельзя
>
{style="note"}

## Списание депозита {id="deposit_writeOff"}
<procedure>
<step>
Создать заказ
</step>
<step>
Добавить гостя в заказ
</step>
<step>
Перейти на экран оплаты
</step>
<step>
Добавить тип оплаты депозитом
</step>
<step>
<p>Ввести номер депозитной карты</p>
<img src="enter_deposit_card.png" alt=""/>
</step>
<step>
<p>Выбрать тип списания</p>
<img src="type_of_writeoff.png" alt=""/>
</step>
<step>
Оплатить заказ
</step>
</procedure>

## Пополнение депозита {id="adding_deposit"}
<procedure>
<a href="https://support.prime-hill.com/integrations/discountcentriiko/#deposit">Настройка</a>
<step>
Создать заказ
</step>
<step>
Добавить в заказ товар, созданный для пополнения
</step>
<step>
Перейти на экран оплаты
</step>
<step>
Добавить тип оплаты для пополнения
</step>
<step>
<p>Ввести номер карты</p>
<img src="enter_deposit_card.png" alt=""/>
</step>
<step>
Оплатить заказ
</step>
</procedure>
>
>Для пополнения депозита также можно использовать доставочные заказы. Логика такая же. Добавить в заказ
товар для пополнения и оплатить типом для пополнения
>
{style="note"}

## Использование скидок, рассчитанных в PrimeHill {id="ph_discount"}
<procedure>
<a href="https://support.prime-hill.com/integrations/discountcentriiko/#discountPH">Настройка</a>
<step>
Создать заказ
</step>
<step>
Добавить гостя в заказ
</step>
<step>
Перейти на экран оплаты
</step>
<step>
Скидка автоматически добавиться как платеж
</step>
<step>
Оплатить заказ
</step>
</procedure>

## Использование скидок, рассчитанных в iiko
<procedure>
<a href="https://support.prime-hill.com/integrations/discountcentriiko/#discountIiko">Настройка</a>
<p>Карта гостя должна значиться как скидочная карта в iikoOffice</p>
<step>
Создать заказ
</step>
<step>
Добавить гостя в заказ
</step>
<step>
К заказу автоматически примениться скидка
</step>
<step>
Перейти на экран оплаты
</step>
<step>
Оплатить заказ
</step>
</procedure>

## Импорт гостей {id="guests_import"}
Плагин в процессе работы через равные промежутки времени запрашивает новых гостей с сервера,
чтобы синхронизировать гостей в PrimeHill и в базе iiko

## Получение информации о госте
<procedure>
<step>
Нажать кнопку "Дополнения"
</step>
<step>
Нажать "PrimeHill: Информация о госте"
</step>
<step>
<p>Ввести номер карты или телефон гостя</p>
<img src="guest_info_request.png" alt=""/>
</step>
<step>
<p>Будет отображена информация о госте</p>
<img src="guest_info.png" alt=""/>
</step>
<step>
При клике на кнопку "Обновить гостя" информация о госте в БРД будет обновлена в соответствии с информацией из
PrimeHill
</step>
</procedure>

## Отправка логов
<procedure>
<step>
Нажать кнопку "Дополнения"
</step>
<step>
Нажать "PrimeHill: Отправить логи"
</step>
<step>
<p>Выбрать дату, за которую отправляются логи</p>
<img src="choose_logs_date.png" alt=""/>
</step>
<step>
<p>Логи будут отправлены на сервер. Найти их можно в личном кабинете PrimeHill в Справочники -> Файлы</p>
<img src="ph_logs.png" alt=""/>
</step>
</procedure>

## Чекин гостя с экрана кассы
<procedure title="Заказ не в статусе пречека" id="payment_screen_checkin">
<step>
Создать заказ
</step>
<step>
Перейти на экран кассы
</step>
<step>
Добавить тип оплаты PrimeHill
</step>
<step>
<p>Ввести номер карты/телефон</p>
<img src="checkin_from_payment_scren.png" alt=""/>
</step>
<step>
<p>Продолжить по сценарию <a href="#bonuses_writeOff">списания бонусов</a></p> или <a href="#ph_discount">скидки PrimeHill</a>
</step>
</procedure>

<procedure title="Заказ в статусе пречека" id="checkin_from_payment_screen_in_bill">
<step>
Создать заказа
</step>
<step>
Напечатать пречек
</step>
<step>
Перейти на экран оплаты
</step>
<step>
Добавить тип олаты PrimeHill
</step>
<step>
<p>Ввести пин-код администратора, заданный в настройках плагина</p>
<img src="admin_pin.png" alt=""/>
</step>
<step>
Продолжить по сценарию <a href="#payment_screen_checkin">чекина с экрана кассы</a>
</step>
</procedure>

## Конвертация скидки в бонусы для доставочных заказов {id="discount_to_payment"}
<procedure>
<step>
<p>Создать доставку через call-центр или любой другой сервис</p>
<img src="new_delivery.png" alt=""/>
</step>
<step>
<p>Добавить скидку, прописанную в конфиге и сохранить на точку</p>
<img src="adding_discount.png" alt=""/>
</step>
<step>
Дождаться появления доставки на iikoFront и отправить ее
</step>
<step>
<p>Сумма скидки станет платежем PrimeHill</p>
<img src="saved_primeHill_payment.png" alt=""/>
</step>
</procedure>

## Работа с 2ФР {id="2fr"}
Ссылка на настройку 2ФР
<procedure>
<step>
Создать заказ
</step>
<step>
Добавить в него блюда с разным типом места приготовления
</step>
<step>
Напечатать пречек
</step>
<step>
<p>Перейти на экран кассы, разделив заказ</p>
<img src="split_order.png" alt=""/>
</step>
<step>
<p>Доступные для оплаты бонусы будут разделены между двумя созданными заказами</p>
<img src="2fr_first.png" alt=""/>
<img src="2fr_second.png" alt=""/>
</step>
</procedure>

## Комбинирование оплаты бонусами и депозитом
<procedure title="Бонусы и депозит на разных картах">
<step>
Добавить бонусный платеж, согласно <a href="#bonuses_writeOff">сценарию списания бонусов</a>
</step>
<step>
Добавить платеж депозитом, согласно <a href="#deposit_writeOff">сценарию списания депозита</a>
</step>
</procedure>

<procedure title="Бонусы и депозит на одной карте">
<step>
Сценарий аналогичен комбинированию бонусов и депозита на разных картах, за тем исключением, что
в качестве депозитной картры вводиться значение бонусной карты
</step>
</procedure>

## Агрессивный экспорт
<procedure>
<step>
Подложить на кассу EXE-файл активатора "агрессивного экспорта"
</step>
<step>
Проверить версию плагина PrimeHill (версия должна быть 7.10.0 и выше)
</step>
<step>
Запустить кассу
</step>
<step>
<p>Запустить активатор, убедиться во всплывающем уведомлении на кассе, что экспорт включен</p>
<note>
Если у вас плагин работает не на стандартном порту (8115), то
активатор не сможет сразу включить режим "агрессивного экспорта" о чем вам и сообщит, 
после чего спросит, не хотели бы вы указать другой порт. Отвечаем да и вводим тот порт, на котором 
работает плагин. После этого режим должен успешно запуститься
</note>
</step>
<step>
Перейти в личный кабинет PrimeHill
</step>
<step>
Выбрать нужных гостей и нажать "экспорт"
</step>
<step>
Дождаться завершения работы "агрессивного экспорта" (плагин пришлет уведомление на кассу)
</step>
<step>
Проверить в папке кеша плагина файл <b>warnings.txt</b>. В этом файле сохраняется информация о тех гостях, 
которых не получилось экспортировать по тем или иным причинам 
(например, было найдено несколько гостей с одинаковым номером телефона или не получилось изменить номер 
карты гостя, потому что этот номер карты уже привязан к другому гостю)
</step>
</procedure>

## Анонимные заказы
Анонимными заказами называются заказы, не содержащие гостя.  
Обработка таких заказов зависит от значения параметра конфигурации **AnonymousCardEnabled**:
+ **true** - плагин обрабатывает такие заказы и отправляет запросы CloseOrder на сервер PrimeHill
+ **false** - плагин игнорирует анонимные заказы